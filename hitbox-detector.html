<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hitbox Detector Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="file"],
        input[type="range"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        input[type="range"] {
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .canvas-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .canvas-wrapper {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        canvas {
            border: 2px solid #333;
            background: repeating-conic-gradient(#eee 0% 25%, white 0% 50%) 50% / 20px 20px;
            image-rendering: pixelated;
        }

        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .results h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .code-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Hitbox Detector Tool</h1>
        <p class="subtitle">è‡ªå‹•æª¢æ¸¬ç²¾éˆåœ–çš„éé€æ˜å€åŸŸä¾†è¨ˆç®—æœ€ä½³ Hitbox è¨­ç½®</p>

        <div class="controls">
            <div class="control-group">
                <label for="imageInput">é¸æ“‡ç²¾éˆåœ–ç‰‡ï¼š</label>
                <input type="file" id="imageInput" accept="image/*">
                
                <label for="alphaThreshold" style="margin-top: 15px;">é€æ˜åº¦é–¾å€¼ (Alpha Threshold): <span id="alphaValue">50</span></label>
                <input type="range" id="alphaThreshold" min="0" max="255" value="50">
                <small style="color: #666;">èª¿æ•´æ­¤å€¼ä¾†æ§åˆ¶ä»€éº¼ç¨‹åº¦çš„é€æ˜è¢«è¦–ç‚ºã€Œé€æ˜ã€</small>
            </div>

            <div class="control-group">
                <label for="scaleInput">ç¸®æ”¾æ¯”ä¾‹ (Scale):</label>
                <input type="number" id="scaleInput" min="0.1" max="5" step="0.1" value="0.4">
                
                <label for="framesInput" style="margin-top: 15px;">å¹€æ•¸ (Frames):</label>
                <input type="number" id="framesInput" min="1" max="20" step="1" value="4">
                <small style="color: #666;">ç²¾éˆåœ–åŒ…å«çš„å‹•ç•«å¹€æ•¸ï¼ˆæ©«å‘æ’åˆ—ï¼‰</small>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="showOriginal" checked>
                    <label for="showOriginal" style="margin: 0;">é¡¯ç¤ºåŸå§‹åœ–ç‰‡</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="showHitbox" checked>
                    <label for="showHitbox" style="margin: 0;">é¡¯ç¤º Hitbox</label>
                </div>

                <button id="analyzeBtn">ğŸ” åˆ†æ Hitbox</button>
            </div>
        </div>

        <div class="canvas-container">
            <div class="canvas-wrapper">
                <h3>åŸå§‹åœ–ç‰‡</h3>
                <canvas id="originalCanvas"></canvas>
            </div>
            <div class="canvas-wrapper">
                <h3>åµæ¸¬çµæœï¼ˆç¶ æ¡† = Hitboxï¼‰</h3>
                <canvas id="resultCanvas"></canvas>
            </div>
        </div>

        <div class="results">
            <h2>ğŸ“Š æª¢æ¸¬çµæœ</h2>
            <div class="stats" id="statsContainer">
                <!-- Stats will be inserted here -->
            </div>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">ğŸ“ é…ç½®ä»£ç¢¼ï¼ˆè¤‡è£½åˆ° character configï¼‰</h3>
            <div class="code-output" id="codeOutput">
// è«‹å…ˆä¸Šå‚³åœ–ç‰‡ä¸¦é»æ“Šã€Œåˆ†æ Hitboxã€æŒ‰éˆ•
            </div>
        </div>
    </div>

    <script type="module">
        import { HitboxDetector } from './js/utils/HitboxDetector.js';

        const imageInput = document.getElementById('imageInput');
        const alphaThreshold = document.getElementById('alphaThreshold');
        const alphaValue = document.getElementById('alphaValue');
        const scaleInput = document.getElementById('scaleInput');
        const framesInput = document.getElementById('framesInput');
        const showOriginal = document.getElementById('showOriginal');
        const showHitbox = document.getElementById('showHitbox');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const originalCanvas = document.getElementById('originalCanvas');
        const resultCanvas = document.getElementById('resultCanvas');
        const statsContainer = document.getElementById('statsContainer');
        const codeOutput = document.getElementById('codeOutput');

        let currentImage = null;
        let currentHitbox = null;

        alphaThreshold.addEventListener('input', (e) => {
            alphaValue.textContent = e.target.value;
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentImage = new Image();
                    currentImage.onload = () => {
                        drawOriginal();
                        analyzeBtn.disabled = false;
                    };
                    currentImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        showOriginal.addEventListener('change', drawResult);
        showHitbox.addEventListener('change', drawResult);
        scaleInput.addEventListener('input', drawResult);
        framesInput.addEventListener('input', drawResult);

        analyzeBtn.addEventListener('click', async () => {
            if (!currentImage) return;

            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'â³ åˆ†æä¸­...';

            try {
                const threshold = parseInt(alphaThreshold.value);
                const frames = parseInt(framesInput.value);
                currentHitbox = await HitboxDetector.detectFromUrl(
                    currentImage.src, 
                    frames, 
                    threshold
                );
                
                displayResults();
                drawResult();
                
                analyzeBtn.textContent = 'âœ… åˆ†æå®Œæˆ';
                setTimeout(() => {
                    analyzeBtn.textContent = 'ğŸ” åˆ†æ Hitbox';
                    analyzeBtn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Analysis error:', error);
                analyzeBtn.textContent = 'âŒ åˆ†æå¤±æ•—';
                analyzeBtn.disabled = false;
            }
        });

        function drawOriginal() {
            if (!currentImage) return;

            originalCanvas.width = currentImage.width;
            originalCanvas.height = currentImage.height;
            
            const ctx = originalCanvas.getContext('2d');
            ctx.clearRect(0, 0, originalCanvas.width, originalCanvas.height);
            ctx.drawImage(currentImage, 0, 0);
        }

        function drawResult() {
            if (!currentImage || !currentHitbox) return;

            const scale = parseFloat(scaleInput.value);
            resultCanvas.width = currentImage.width;
            resultCanvas.height = currentImage.height;
            
            const ctx = resultCanvas.getContext('2d');
            ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
            
            // Draw original image if checkbox is checked
            if (showOriginal.checked) {
                ctx.globalAlpha = 0.5;
                ctx.drawImage(currentImage, 0, 0);
                ctx.globalAlpha = 1.0;
            }
            
            // Draw hitbox if checkbox is checked
            if (showHitbox.checked) {
                ctx.strokeStyle = 'lime';
                ctx.lineWidth = 3;
                ctx.strokeRect(
                    currentHitbox.offset.x,
                    currentHitbox.offset.y,
                    currentHitbox.width,
                    currentHitbox.height
                );
                
                // Draw scaled hitbox in red
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(
                    currentHitbox.offset.x * scale,
                    currentHitbox.offset.y * scale,
                    currentHitbox.width * scale,
                    currentHitbox.height * scale
                );
                ctx.setLineDash([]);
                
                // Add labels
                ctx.fillStyle = 'lime';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('åŸå§‹ Hitbox', currentHitbox.offset.x + 5, currentHitbox.offset.y - 5);
                
                ctx.fillStyle = 'red';
                ctx.fillText(`ç¸®æ”¾å¾Œ (${scale}x)`, currentHitbox.offset.x * scale + 5, currentHitbox.offset.y * scale - 5);
            }
        }

        function displayResults() {
            if (!currentHitbox) return;

            const scale = parseFloat(scaleInput.value);
            const scaled = {
                offset: {
                    x: Math.round(currentHitbox.offset.x * scale),
                    y: Math.round(currentHitbox.offset.y * scale)
                },
                width: Math.round(currentHitbox.width * scale),
                height: Math.round(currentHitbox.height * scale)
            };

            // Display stats
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Offset X</div>
                    <div class="stat-value">${scaled.offset.x}px</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Offset Y</div>
                    <div class="stat-value">${scaled.offset.y}px</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Width</div>
                    <div class="stat-value">${scaled.width}px</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Height</div>
                    <div class="stat-value">${scaled.height}px</div>
                </div>
            `;

            // Generate code
            codeOutput.textContent = `// Hitbox configuration (scale: ${scale})
hitbox: {
    offset: { x: ${scaled.offset.x}, y: ${scaled.offset.y} },
    width: ${scaled.width},
    height: ${scaled.height}
},

// åŸå§‹åœ–ç‰‡å°ºå¯¸: ${currentHitbox.imageSize.width}x${currentHitbox.imageSize.height}
// åŸå§‹ Hitbox: offset(${currentHitbox.offset.x}, ${currentHitbox.offset.y}), size(${currentHitbox.width}x${currentHitbox.height})
// ç¸®æ”¾å¾Œ Hitbox: offset(${scaled.offset.x}, ${scaled.offset.y}), size(${scaled.width}x${scaled.height})`;
        }
    </script>
</body>
</html>
